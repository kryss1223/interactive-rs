{% extends 'main/base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block content %}

<!-- HERO -->
<section class="hero glass">
    <div class="hero-live">LIVE</div>
    <div class="hero-sub">Día 1: La Casa de los Gemelos</div>
    <div class="hero-timer"><i class="bi bi-clock"></i> Termina en 03:22:54</div>
    <img src="{% static 'main/img/fondolacasadelosgemelos.jpg' %}" alt="imgdirecto">
    <button class="btn-primary">Comenzar a ver</button>
</section>

<!-- RANKING -->
<section class="glass animate-fadein">
    <h2 class="ali-title"><i class="bi bi-trophy-fill"></i> RANKING</h2>
    <ul class="rank-list">
        {% for p in participantes %}
        <li>
            <span class="rank-pos">{{ forloop.counter }}</span>
            {% if p.foto %}
                <div class="rank-img-wrapper">
                    <img class="imgRanking" src="{{ p.foto.url }}" alt="{{ p.nombre }}">
                </div>
            {% else %}
                <img class="imgRanking" src="{% static 'main/img/default.png' %}" alt="{{ p.nombre }}">
            {% endif %}

            <div class="rank-info">
                <a class="rank-name" href="{% url 'participante_detalle' p.id %}">
                    {{ p.nombre }}
                </a>
                <span class="rank-points">{{ p.puntos_totales }} <i class="bi bi-lightning-charge-fill"></i></span>
            </div>

            {% if request.user.is_authenticated and p.id in votos_usuario %}
                <button class="btn-disabled" disabled>✔</button>
            {% else %}
                <form method="POST" action="{% url 'votar' p.id %}">
                    {% csrf_token %}
                    <button class="btn-votar">Votar</button>
                </form>
            {% endif %}

        </li>
        {% endfor %}

    </ul>
</section>


<section class="panel-aliado glass animate-pop">
    <h2 class="ali-title"><i class="bi bi-people-fill"></i> TEAM</h2>

    {% if aliado %}
        <div class="aliado-card">

            <!-- FOTO -->
            <div class="aliado-photo-wrapper">
                <img class="aliado-photo" src="{{ aliado.participante.foto.url }}" alt="{{ aliado.participante.nombre }}">
            </div>

            <!-- INFO -->
            <div class="aliado-info">
                <h3 class="aliado-name">
                    {{ aliado.participante.nombre }}
                    
                </h3>

                <p class="aliado-meta"><strong>Desde:</strong> {{ dias_aliado }} día{% if dias_aliado != 1 %}s{% endif %}</p>
                <p class="aliado-meta"><strong>Puntos:</strong> {{ aliado.participante.puntos_totales }} <i class="bi bi-lightning-charge-fill"></i></p>

               {% widthratio aliado.participante.votos_recibidos 500 100 as afinidad %}
                <div class="aliado-progress">
                    <div class="aliado-progress-fill" style="width: {{ afinidad }}%;"></div>
                </div>
                <p class="aliado-progress-label">Afinidad del público ({{ afinidad }}%)</p>


                <!-- BOTONES -->
                
                    <a href="{% url 'participante_detalle' aliado.participante.id %}" class="btn-primary">Ver perfil</a>
                

            </div>
        </div>

    {% else %}
        <p class="no-aliado">No tienes aliado aún.</p>
        <a href="{% url 'participantes' %}" class="btn-glow">Elegir aliado</a>
    {% endif %}
</section>

<!-- TOP VIDEOS -->
<section class="panel glass top-videos-section animate-fadein">
    <h2 class="ali-title"><i class="bi bi-camera-reels-fill"></i> TOP VIDEOS</h2>

    <div class="top-videos-list">
        {% for v in top_videos %}
            <div class="top-video-item">

                <!-- Miniatura = foto del participante -->
                <img src="{{ v.thumbnail }}" class="top-video-thumb" alt="Foto participante">

                <div class="top-video-info">
                    <!-- Nombre del participante -->
                    <p class="top-video-name">{{ v.participante.nombre }}</p>
                    
                    <!-- Fecha del video -->
                    <p class="top-video-date">
                        {{ v.fecha_subida|date:"d/m/Y H:i" }}
                    </p>

                    <!-- Botón para ver el video -->
                    <a href="{{ v.url_video }}" target="_blank" class="top-video-btn">Ver video</a>
                </div>

            </div>
        {% empty %}
            <p class="no-videos">No hay videos aún</p>
        {% endfor %}
    </div>
</section>



{% endblock %}
